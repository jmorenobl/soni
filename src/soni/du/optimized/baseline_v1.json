{
  "predictor": {
    "traces": [],
    "train": [],
    "demos": [
      {
        "augmented": true,
        "user_message": "I'm not sure",
        "history": {
          "messages": [
            {
              "role": "user",
              "content": "Book flight to Paris tomorrow"
            },
            {
              "role": "assistant",
              "content": "Confirm: Flight to Paris, departing tomorrow?"
            }
          ]
        },
        "context": {
          "current_slots": {
            "destination": "Paris",
            "departure_date": "tomorrow"
          },
          "available_actions": [
            "search_flights",
            "book_flight",
            "modify_booking",
            "cancel_booking",
            "send_confirmation"
          ],
          "available_flows": {
            "book_flight": "book_flight",
            "search_flights": "search_flights",
            "check_booking": "check_booking",
            "modify_booking": "modify_booking",
            "cancel_booking": "cancel_booking"
          },
          "current_flow": "book_flight",
          "expected_slots": [],
          "current_prompted_slot": null,
          "conversation_state": "confirming"
        },
        "current_datetime": "2024-12-11T10:00:00",
        "result": {
          "message_type": "confirmation",
          "command": "book_flight",
          "slots": [],
          "confidence": 0.7,
          "confirmation_value": null
        }
      },
      {
        "user_message": "No, for 3 passengers",
        "history": {
          "messages": [
            {
              "user_message": "Book a flight from Paris to London next week",
              "result": {
                "command": "book_flight",
                "message_type": "interruption",
                "slots": [
                  {
                    "name": "origin",
                    "value": "Paris"
                  },
                  {
                    "name": "destination",
                    "value": "London"
                  },
                  {
                    "name": "departure_date",
                    "value": "next week"
                  }
                ]
              }
            }
          ]
        },
        "context": {
          "current_slots": {
            "origin": "Paris",
            "destination": "London",
            "departure_date": "next week"
          },
          "available_actions": [
            "search_flights",
            "book_flight",
            "modify_booking",
            "cancel_booking",
            "send_confirmation"
          ],
          "available_flows": {
            "book_flight": "book_flight",
            "search_flights": "search_flights",
            "check_booking": "check_booking",
            "modify_booking": "modify_booking",
            "cancel_booking": "cancel_booking"
          },
          "current_flow": "book_flight",
          "expected_slots": [],
          "current_prompted_slot": null,
          "conversation_state": "ready_for_confirmation"
        },
        "current_datetime": "2024-12-11T10:00:00",
        "result": {
          "message_type": "correction",
          "command": "book_flight",
          "slots": [
            {
              "name": "passengers",
              "value": "3",
              "confidence": 0.95,
              "action": "provide",
              "previous_value": null
            }
          ],
          "confidence": 0.95,
          "confirmation_value": null
        }
      },
      {
        "user_message": "maybe",
        "history": {
          "messages": [
            {
              "user_message": "I want to buy a laptop",
              "result": {
                "command": "search_product",
                "message_type": "interruption",
                "slots": [
                  {
                    "name": "product",
                    "value": "laptop"
                  }
                ]
              }
            }
          ]
        },
        "context": {
          "current_slots": {
            "product": "laptop",
            "quantity": "1"
          },
          "available_actions": [
            "search_products",
            "add_to_cart",
            "process_payment",
            "track_shipment",
            "initiate_return"
          ],
          "available_flows": {
            "search_product": "search_product",
            "add_to_cart": "add_to_cart",
            "checkout": "checkout",
            "track_order": "track_order",
            "return_product": "return_product"
          },
          "current_flow": "search_product",
          "expected_slots": [],
          "current_prompted_slot": null,
          "conversation_state": null
        },
        "current_datetime": "2024-12-11T10:00:00",
        "result": {
          "message_type": "confirmation",
          "command": "search_product",
          "slots": [],
          "confidence": 0.7,
          "confirmation_value": null
        }
      },
      {
        "user_message": "Can I bring my pet?",
        "history": {
          "messages": [
            {
              "user_message": "Book a flight"
            }
          ]
        },
        "context": {
          "current_slots": {},
          "available_actions": [
            "search_flights",
            "book_flight",
            "modify_booking",
            "cancel_booking",
            "send_confirmation"
          ],
          "available_flows": {
            "book_flight": "book_flight",
            "search_flights": "search_flights",
            "check_booking": "check_booking",
            "modify_booking": "modify_booking",
            "cancel_booking": "cancel_booking"
          },
          "current_flow": "book_flight",
          "expected_slots": [
            "origin"
          ],
          "current_prompted_slot": null,
          "conversation_state": null
        },
        "current_datetime": "2024-12-11T10:00:00",
        "result": {
          "message_type": "digression",
          "command": "book_flight",
          "slots": [],
          "confidence": 0.85,
          "confirmation_value": null
        }
      },
      {
        "user_message": "Do you have vegetarian options?",
        "history": {
          "messages": [
            {
              "user_message": "Book a table in Madrid"
            }
          ]
        },
        "context": {
          "current_slots": {
            "location": "Madrid"
          },
          "available_actions": [
            "search_restaurants",
            "book_table",
            "modify_reservation",
            "cancel_reservation",
            "send_confirmation"
          ],
          "available_flows": {
            "book_table": "book_table",
            "search_restaurants": "search_restaurants",
            "check_reservation": "check_reservation",
            "modify_reservation": "modify_reservation",
            "cancel_reservation": "cancel_reservation"
          },
          "current_flow": "book_table",
          "expected_slots": [
            "date"
          ],
          "current_prompted_slot": null,
          "conversation_state": null
        },
        "current_datetime": "2024-12-11T10:00:00",
        "result": {
          "message_type": "digression",
          "command": "book_table",
          "slots": [],
          "confidence": 0.85,
          "confirmation_value": null
        }
      },
      {
        "user_message": "Proceed",
        "history": {
          "messages": [
            {
              "user_message": "I want to buy a laptop"
            }
          ]
        },
        "context": {
          "current_slots": {},
          "available_actions": [
            "search_products",
            "add_to_cart",
            "process_payment",
            "track_shipment",
            "initiate_return"
          ],
          "available_flows": {
            "search_product": "search_product",
            "add_to_cart": "add_to_cart",
            "checkout": "checkout",
            "track_order": "track_order",
            "return_product": "return_product"
          },
          "current_flow": "search_product",
          "expected_slots": [
            "product"
          ],
          "current_prompted_slot": null,
          "conversation_state": null
        },
        "current_datetime": "2024-12-11T10:00:00",
        "result": {
          "message_type": "continuation",
          "command": "search_product",
          "slots": [],
          "confidence": 0.9,
          "confirmation_value": null
        }
      },
      {
        "user_message": "I want a red laptop",
        "history": {
          "messages": []
        },
        "context": {
          "current_slots": {},
          "available_actions": [
            "search_products",
            "add_to_cart",
            "process_payment",
            "track_shipment",
            "initiate_return"
          ],
          "available_flows": {
            "search_product": "search_product",
            "add_to_cart": "add_to_cart",
            "checkout": "checkout",
            "track_order": "track_order",
            "return_product": "return_product"
          },
          "current_flow": "none",
          "expected_slots": [
            "product",
            "quantity",
            "color",
            "size",
            "shipping_address"
          ],
          "current_prompted_slot": null,
          "conversation_state": null
        },
        "current_datetime": "2024-12-11T10:00:00",
        "result": {
          "message_type": "interruption",
          "command": "search_product",
          "slots": [
            {
              "name": "product",
              "value": "laptop",
              "confidence": 0.9,
              "action": "provide",
              "previous_value": null
            },
            {
              "name": "color",
              "value": "red",
              "confidence": 0.9,
              "action": "provide",
              "previous_value": null
            }
          ],
          "confidence": 0.9,
          "confirmation_value": null
        }
      },
      {
        "user_message": "Wait, I said 50 not 500",
        "history": {
          "messages": [
            {
              "role": "user",
              "content": "Transfer 500 to mom"
            }
          ]
        },
        "context": {
          "current_slots": {
            "amount": "500",
            "recipient": "mom"
          },
          "available_actions": [
            "execute_transfer",
            "get_balance",
            "activate_card_service",
            "block_card_service",
            "fetch_transactions"
          ],
          "available_flows": {
            "transfer_funds": "transfer_funds",
            "check_balance": "check_balance",
            "activate_card": "activate_card",
            "block_card": "block_card",
            "transaction_history": "transaction_history"
          },
          "current_flow": "transfer_funds",
          "expected_slots": [
            "currency"
          ],
          "current_prompted_slot": null,
          "conversation_state": null
        },
        "current_datetime": "2024-12-11T10:00:00",
        "result": {
          "message_type": "correction",
          "command": "transfer_funds",
          "slots": [
            {
              "name": "amount",
              "value": "50",
              "confidence": 0.95,
              "action": "provide",
              "previous_value": null
            }
          ],
          "confidence": 0.95,
          "confirmation_value": null
        }
      },
      {
        "user_message": "No, change the destination",
        "history": {
          "messages": [
            {
              "role": "assistant",
              "content": "Confirming: Flight to NYC on Dec 25. Correct?"
            }
          ]
        },
        "context": {
          "current_slots": {
            "destination": "NYC",
            "date": "2025-12-25"
          },
          "available_actions": [
            "book_flight",
            "send_confirmation"
          ],
          "available_flows": {
            "book_flight": "book_flight"
          },
          "current_flow": "book_flight",
          "expected_slots": [],
          "current_prompted_slot": null,
          "conversation_state": "confirming"
        },
        "current_datetime": "2024-12-11T10:00:00",
        "result": {
          "message_type": "confirmation",
          "command": "book_flight",
          "slots": [],
          "confidence": 0.95,
          "confirmation_value": false
        }
      }
    ],
    "signature": {
      "instructions": "Analyze and classify user messages within a dialogue context to determine intent and extract any relevant slot values. Classify the message into one of the following categories:\n- **slot_value**: The user provides a value for an expected slot.\n- **confirmation**: The user confirms or denies (responds with yes/no). If user denies without providing a new value, classify as confirmation (value=False).\n- **correction**: The user corrects a previously provided slot value.\n- **modification**: The user requests to change a slot value and provides the new value.\n- **interruption**: The user wishes to start or switch to a new flow from available options.\n- **cancellation**: The user abandons the current flow.\n- **digression**: The message is off-topic and does not correspond to any available flow.\n- **clarification**: The user seeks clarification about the current request.\n- **continuation**: The user's intent is unclear but they're proceeding with the conversation.\n\nObserve the following key rules:\n1. Match user messages semantically to the descriptions of available flows, not just based on exact wording.\n2. If a message matches a flow, classify it as an **interruption** for that flow.\n3. Only use **digression** when the message does not fit any available flow.\n4. Extract slot values from the message with the appropriate action type defined as provide (new), correct (reactive fix), or modify (proactive change).\n\nKeep the instruction clear and concise to guide the Language Model effectively.",
      "fields": [
        {
          "prefix": "User Message:",
          "description": "User's input message to analyze"
        },
        {
          "prefix": "History:",
          "description": "Conversation history (list of {role, content} messages)"
        },
        {
          "prefix": "Context:",
          "description": "Current dialogue state including flow, slots, and conversation phase"
        },
        {
          "prefix": "Current Datetime:",
          "description": "Current datetime (ISO format) for temporal expressions"
        },
        {
          "prefix": "Result:",
          "description": "Classified message with type, intent, slots, and confidence"
        }
      ]
    },
    "lm": null
  },
  "metadata": {
    "dependency_versions": {
      "python": "3.13",
      "dspy": "3.0.4",
      "cloudpickle": "3.1"
    }
  }
}
