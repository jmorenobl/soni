flows:
  # Account Balance
  check_balance:
    description: "Check current balance of a bank account"
    trigger:
      intents:
        - "What's my balance?"
        - "Check my balance"
        - "How much money do I have?"
    steps:
      - step: collect_account_type
        type: collect
        slot: account_type
        message: "Which account would you like to check? (checking/savings)"

      - step: get_balance
        type: action
        call: get_balance
        map_outputs:
          balance: current_balance
          currency: currency_code

      - step: respond
        type: say
        message: "Your {account_type} account balance is {current_balance} {currency_code}."

  # Transaction History with pagination (branch + jump_to pattern)
  check_transactions:
    description: "View paginated transaction history"
    intent: check_transactions
    slots:
      - account_type:
          type: string
          ask: "Which account would you like to check transactions for? (checking/savings)"
      - transaction_period:
          type: string
          ask: "For what time period? I can show you the last week, last month, or last 3 months."
    process:
      # Collect required information
      - step: collect_account
        type: collect
        slot: account_type
        message: "Which account would you like to check transactions for? (checking/savings)"

      - step: collect_period
        type: collect
        slot: transaction_period
        message: "For what time period? I can show you the last week, last month, or last 3 months."

      # Initialize pagination
      - step: init_pagination
        type: action
        call: start_browsing
        map_outputs:
          page: transaction_page
          continue: continue_browsing

      # Fetch and display page
      - step: fetch_transactions
        type: action
        call: get_transactions_paginated
        map_outputs:
          transactions_summary: transactions_summary
          total_income: total_income
          total_expenses: total_expenses
          has_more: has_more_transactions

      - step: say_transactions
        type: say
        message: |
          Here are your transactions from your {account_type} account ({transaction_period}):

          {transactions_summary}

          Summary:
          - Total income: +{total_income} EUR
          - Total expenses: {total_expenses} EUR

      # Check if more available
      - step: check_more
        type: branch
        slot: has_more_transactions
        cases:
          "yes": ask_continue
          "no": end_transactions

      # Ask user if they want more (interactive - uses branch + jump_to pattern)
      - step: ask_continue
        type: collect
        slot: view_more_transactions
        message: "Would you like to see more transactions? (yes/no)"

      - step: handle_response
        type: branch
        slot: view_more_transactions
        cases:
          "yes": next_page
          "no": end_transactions

      # Prepare next page and loop back
      - step: next_page
        type: action
        call: increment_page
        map_outputs:
          page: transaction_page
        jump_to: fetch_transactions  # Loop back via jump_to

      # End of transactions
      - step: end_transactions
        type: say
        message: "That's all your recent transactions. Is there anything else I can help you with?"

  # Security Alerts Review - DEMONSTRATES WHILE LOOP
  # This is a perfect while loop use case: automatic iteration without user input
  review_security_alerts:
    description: "Review pending security alerts automatically"
    intent: review_security_alerts
    process:
      # Initialize alert review
      - step: init_alerts
        type: action
        call: initialize_alerts
        map_outputs:
          total: total_alerts
          current: alert_index

      # While loop - iterate through all alerts automatically
      - step: alerts_loop
        type: while
        condition: "alert_index < total_alerts"
        do:
          - get_alert
          - show_alert
          - mark_reviewed
          - next_alert

      # Get current alert
      - step: get_alert
        type: action
        call: get_next_alert
        map_outputs:
          alert_type: current_alert_type
          alert_message: current_alert_message
          alert_date: current_alert_date

      # Display alert
      - step: show_alert
        type: say
        message: |
          Security Alert #{alert_index}:
          Type: {current_alert_type}
          Date: {current_alert_date}
          Message: {current_alert_message}

      # Mark as reviewed
      - step: mark_reviewed
        type: action
        call: mark_alert_reviewed

      # Move to next alert
      - step: next_alert
        type: action
        call: increment_alert_index
        map_outputs:
          index: alert_index

      # After all alerts reviewed
      - step: alerts_complete
        type: say
        message: "All {total_alerts} security alerts have been reviewed. Your account is up to date."
